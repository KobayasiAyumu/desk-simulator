<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desk Setup Simulator (Interactive)</title>
    <style>
        body {
            background-color: #222;
            color: #eee;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: sans-serif;
            user-select: none; /* æ–‡å­—é¸æŠã‚’é˜²æ­¢ */
        }
        canvas {
            border: 2px solid #555;
            background-color: #333;
            border-radius: 4px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            cursor: none; /* OSã®ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ¶ˆã™ï¼ˆè‡ªå‰ã®ã‚«ãƒ¼ã‚½ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ï¼‰ */
        }
        .controls { margin-top: 10px; padding: 10px; background: #444; border-radius: 8px; }
    </style>
</head>
<body>

    <h1>ğŸ–±ï¸ Click to Move Desk</h1>
    <canvas id="isoCanvas" width="800" height="600"></canvas>
    
    <div class="controls">
        <p>ãƒã‚¦ã‚¹ã‚’å‹•ã‹ã—ã¦ä½ç½®ã‚’æ±ºã‚ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦é…ç½®ï¼</p>
    </div>

    <script>
        const canvas = document.getElementById('isoCanvas');
        const ctx = canvas.getContext('2d');

        // === è¨­å®šå€¤ ===
        const GRID_SIZE = 10;
        const TILE_WIDTH = 60;
        const TILE_HEIGHT = 30;
        const ORIGIN_X = canvas.width / 2;
        const ORIGIN_Y = 150;

        // æœºã®ä½ç½®
        let deskX = 2;
        let deskY = 3;

        // ãƒã‚¦ã‚¹ãŒä»Šä¹—ã£ã¦ã„ã‚‹ã‚°ãƒªãƒƒãƒ‰ã®ä½ç½®
        let hoverX = -1;
        let hoverY = -1;

        // ==========================================
        // ğŸ“ åº§æ¨™å¤‰æ› (Grid <-> Screen)
        // ==========================================
        
        // ã‚°ãƒªãƒƒãƒ‰ -> ç”»é¢ (å‰å›ã¨åŒã˜)
        function toScreen(gx, gy, gz = 0) {
            const screenX = ORIGIN_X + (gx - gy) * (TILE_WIDTH / 2);
            const screenY = ORIGIN_Y + (gx + gy) * (TILE_HEIGHT / 2) - (gz * TILE_HEIGHT);
            return { x: screenX, y: screenY };
        }

        // ç”»é¢ -> ã‚°ãƒªãƒƒãƒ‰ (â˜…ä»Šå›ã®æ–°å…µå™¨ï¼šé€†å¤‰æ›)
        function toGrid(screenX, screenY) {
            // åŸç‚¹ã‹ã‚‰ã®ã‚ºãƒ¬ã‚’è¨ˆç®—
            const adjX = screenX - ORIGIN_X;
            const adjY = screenY - ORIGIN_Y;

            // é€£ç«‹æ–¹ç¨‹å¼ã‚’è§£ã„ã¦ gridX, gridY ã‚’å°ãå‡ºã™
            // (è©³ç´°ãªæ•°å­¦çš„èª¬æ˜ã¯çœãã¾ã™ãŒã€ã“ã‚ŒãŒã‚¢ã‚¤ã‚½ãƒ¡ãƒˆãƒªãƒƒã‚¯ã®é€†è¨ˆç®—å¼ã§ã™)
            const gy = (adjY / (TILE_HEIGHT / 2) - adjX / (TILE_WIDTH / 2)) / 2;
            const gx = (adjY / (TILE_HEIGHT / 2) + adjX / (TILE_WIDTH / 2)) / 2;

            return { x: Math.floor(gx), y: Math.floor(gy) };
        }

        // ==========================================
        // ğŸ® ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
        // ==========================================

        // ãƒã‚¦ã‚¹ãŒå‹•ã„ãŸæ™‚
        canvas.addEventListener('mousemove', (e) => {
            // Canvaså†…ã§ã®ãƒã‚¦ã‚¹åº§æ¨™ã‚’å–å¾—
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            // ç”»é¢åº§æ¨™ã‚’ã‚°ãƒªãƒƒãƒ‰åº§æ¨™ã«å¤‰æ›
            const gridPos = toGrid(mouseX, mouseY);
            
            // ã‚°ãƒªãƒƒãƒ‰ã®å¤–ã«ã¯ã¿å‡ºã—ã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
            if (gridPos.x >= 0 && gridPos.x < GRID_SIZE && 
                gridPos.y >= 0 && gridPos.y < GRID_SIZE) {
                hoverX = gridPos.x;
                hoverY = gridPos.y;
            } else {
                hoverX = -1;
                hoverY = -1;
            }
            
            // ç”»é¢ã‚’å†æç”»
            drawMap();
        });

        // ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚
        canvas.addEventListener('click', () => {
            // ã‚«ãƒ¼ã‚½ãƒ«ãŒæœ‰åŠ¹ãªä½ç½®ã«ã‚ã‚Œã°ã€ãã“ã«æœºã‚’ç§»å‹•
            if (hoverX !== -1 && hoverY !== -1) {
                deskX = hoverX;
                deskY = hoverY;
                drawMap();
            }
        });

        // ==========================================
        // ğŸ¨ æç”»é–¢æ•°
        // ==========================================

        function drawTile(gx, gy, color = null) {
            const top = toScreen(gx, gy, 0);
            const right = toScreen(gx + 1, gy, 0);
            const bottom = toScreen(gx + 1, gy + 1, 0);
            const left = toScreen(gx, gy + 1, 0);

            ctx.beginPath();
            ctx.moveTo(top.x, top.y);
            ctx.lineTo(right.x, right.y);
            ctx.lineTo(bottom.x, bottom.y);
            ctx.lineTo(left.x, left.y);
            ctx.closePath();

            // å¼•æ•°ã§è‰²ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚Œã°ãã‚Œã‚’ä½¿ã†ï¼ˆãƒã‚¤ãƒ©ã‚¤ãƒˆç”¨ï¼‰
            if (color) {
                ctx.fillStyle = color;
            } else {
                ctx.fillStyle = (gx + gy) % 2 === 0 ? '#555' : '#444';
            }
            
            ctx.fill();
            ctx.strokeStyle = '#666';
            ctx.stroke();
        }

        function drawCube(gx, gy, width, depth, height, colorTop, colorSide) {
            const p1 = toScreen(gx, gy, 0);
            const p4 = toScreen(gx, gy + depth, 0);
            const p3 = toScreen(gx + width, gy + depth, 0);
            
            const h = height;
            const t1 = toScreen(gx, gy, h);
            const t2 = toScreen(gx + width, gy, h);
            const t3 = toScreen(gx + width, gy + depth, h);
            const t4 = toScreen(gx, gy + depth, h);

            // å·¦å´é¢
            ctx.fillStyle = colorSide;
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y); ctx.lineTo(p4.x, p4.y); ctx.lineTo(t4.x, t4.y); ctx.lineTo(t1.x, t1.y);
            ctx.closePath(); ctx.fill(); ctx.stroke();

            // å³å´é¢
            ctx.fillStyle = colorSide;
            ctx.beginPath();
            ctx.moveTo(p4.x, p4.y); ctx.lineTo(p3.x, p3.y); ctx.lineTo(t3.x, t3.y); ctx.lineTo(t4.x, t4.y);
            ctx.closePath(); ctx.fill(); ctx.stroke();
            
            // ä¸Šé¢
            ctx.fillStyle = colorTop;
            ctx.beginPath();
            ctx.moveTo(t1.x, t1.y); ctx.lineTo(t2.x, t2.y); ctx.lineTo(t3.x, t3.y); ctx.lineTo(t4.x, t4.y);
            ctx.closePath(); ctx.fill(); ctx.stroke();
        }

        function drawMap() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. åºŠã‚’æã
            for (let y = 0; y < GRID_SIZE; y++) {
                for (let x = 0; x < GRID_SIZE; x++) {
                    // ã‚‚ã—ãƒã‚¦ã‚¹ãŒä¹—ã£ã¦ã„ã‚‹å ´æ‰€ãªã‚‰ã€é»„è‰²ãå¡—ã‚‹
                    if (x === hoverX && y === hoverY) {
                        drawTile(x, y, 'rgba(255, 235, 59, 0.6)'); // åŠé€æ˜ã®é»„è‰²
                    } else {
                        drawTile(x, y);
                    }
                }
            }

            // 2. æœºã‚’æã
            drawCube(deskX, deskY, 3, 2, 1.5, '#8e44ad', '#6c3483');
        }

        drawMap();

    </script>
</body>
</html>